---
id: '3'
title: "Generador de Reportes Pok茅mon en Azure"
description: "Soluci贸n escalable para generaci贸n de reportes CSV con datos enriquecidos de Pok茅mon, implementando arquitectura serverless en Azure."
slug: "pokemon-report-generator"
date: "2025-08-08"
image: "/img/projects/queue/queue.png"
technologies: ["Next.js", "FastAPI", "Azure Functions", "Azure SQL", "Blob Storage", "Terraform"]
featured: true
category: "Cloud Architecture"
role: "Full Stack Developer"
---

# Generador de Reportes Pok茅mon en Azure

## Visi贸n General

Desarroll茅 un sistema completo para generar reportes CSV con estad铆sticas detalladas de Pok茅mon, implementando tres funcionalidades clave:

1. **Eliminaci贸n segura de reportes** (Frontend + Backend + Blob Storage)
2. **Enriquecimiento de datos** (Azure Function + PokeAPI)
3. **Muestreo aleatorio** (Frontend + Backend + Proceso de cola)

![Diagrama de Arquitectura](/img/projects/queue/diagrama_queue.jpg)
*Figura 1: Diagrama de la soluci贸n completa*

## Arquitectura T茅cnica

| Componente            | Tecnolog铆a          | Responsabilidad                          |
|-----------------------|---------------------|------------------------------------------|
| Frontend              | Next.js (React)     | Interfaz de usuario y gesti贸n de estado  |
| Backend API           | FastAPI (Python)    | Endpoints REST y l贸gica de negocio       |
| Procesamiento         | Azure Functions     | Generaci贸n as铆ncrona de reportes         |
| Almacenamiento        | Azure Blob Storage  | Archivos CSV generados                   |
| Mensajer铆a            | Queue Storage       | Comunicaci贸n entre servicios             |
| Base de Datos         | Azure SQL           | Registros de reportes y metadatos        |
| Eventos en Tiempo Real| Server-Sent Events  | Actualizaciones de progreso              |

## Implementaci贸n Clave

### 1. Eliminaci贸n Completa de Reportes

Soluci贸n implementada en capas:

```python
# Backend - FastAPI
@app.delete("/request/{id}")
async def delete_request(id: int):
    result = await delete_pokemon_request(id)
    await sse_manager.broadcast({
        "type": "report_deleted",
        "data": {"id": id}
    })
    return result

# Controlador
async def delete_pokemon_request(id: int) -> dict:
    blob = ABlob()
    blob_name = f"poke_report_{id}.csv"
    await blob.delete_blob(blob_name)
    await execute_query("DELETE FROM pokequeue.request WHERE id = ?", (id,))
```

```jsx
// Frontend - React
const handleDeleteReport = async (reportId) => {
  await deleteReport(reportId);
  setReports(prev => prev.filter(r => r.ReportId !== reportId));
};
```

### 2. Enriquecimiento de Datos

Proceso en la Azure Function:

```python
def get_pokemon_details(pokemon_url: str) -> dict:
    response = requests.get(pokemon_url)
    data = response.json()
    
    return {
        "hp": data["stats"][0]["base_stat"],
        "attack": data["stats"][1]["base_stat"],
        "defense": data["stats"][2]["base_stat"],
        "special_attack": data["stats"][3]["base_stat"],
        "special_defense": data["stats"][4]["base_stat"],
        "speed": data["stats"][5]["base_stat"],
        "abilities": ", ".join([a["ability"]["name"] for a in data["abilities"][:3]])
    }
```

### 3. Muestreo Aleatorio

Implementaci贸n del sampling:

```python
if sample_size and 0 < sample_size < len(pokemons):
    pokemons = random.sample(pokemons, sample_size)
```

## Server-Sent Events (SSE)

Implement茅 un sistema de notificaciones en tiempo real para:

- Progreso de generaci贸n de reportes
- Actualizaciones de estado
- Eliminaciones confirmadas

```python
# Backend - SSE Manager
class SSEManager:
    def __init__(self):
        self.connections: Dict[str, asyncio.Queue] = {}
    
    async def broadcast(self, message: dict):
        for queue in self.connections.values():
            await queue.put(json.dumps(message))

# Frontend - Hook personalizado
export function useSSE() {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    const eventSource = new EventSource('/events');
    eventSource.onmessage = (e) => setData(JSON.parse(e.data));
    return () => eventSource.close();
  }, []);
  
  return data;
}
```

## Desaf铆os y Soluciones

| Desaf铆o                          | Soluci贸n Implementada               |
|----------------------------------|-------------------------------------|
| Sincronizaci贸n estado frontend   | SSE + Context API                   |
| Eliminaci贸n at贸mica              | Transacciones impl铆citas en Blob + SQL |
| Muestreo de grandes datasets     | Procesamiento por lotes en funci贸n  |
| Tiempos de respuesta PokeAPI     | Cache local + manejo de errores     |

## Repositorios del Proyecto

1.  [Frontend (Next.js)](https://github.com/MikeWinchester/pokemon_ui)
2.  [Backend API (FastAPI)](https://github.com/MikeWinchester/pokemon_api)
3.  [Azure Functions](https://github.com/MikeWinchester/pokemon_function)
4.  [Database Scripts](https://github.com/MikeWinchester/pokemon_sql)
5.  [Infra as Code (Terraform)](https://github.com/MikeWinchester/pokemon_terraform)

## Demo en Vivo

 [Aplicaci贸n Desplegada en Azure](https://ui-pokequeue-dev-v1.azurewebsites.net)

## Conclusi贸n

Este proyecto demostr贸 mi capacidad para:
- Dise帽ar arquitecturas serverless complejas
- Implementar soluciones de procesamiento as铆ncrono
- Integrar m煤ltiples servicios de Azure
- Desarrollar interfaces reactivas con actualizaciones en tiempo real

La combinaci贸n de Next.js, FastAPI y Azure Functions result贸 en una soluci贸n escalable y mantenible, con un costo operativo optimizado gracias al modelo serverless.
